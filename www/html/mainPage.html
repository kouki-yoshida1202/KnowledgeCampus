<ons-page id="mainPage">
  <style>
    #mainPage .toolbar__left,
    #mainPage .toolbar__right {
      width: 15%;
    }

    #mainPage .toolbar {
      background-image: none;
    }

    #mainPage .toolbar__center {
      width: 70%;
    }
    #tabCarousel .item-label,
    #tabChatCarousel .item-label,
    #tabMySyuppinCarousel .item-label,
    #tabMyBoughtCarousel .item-label {
      text-align: center;
      font-size: 0.8em;
      padding: 3px;
    }

    .active_tabCarousel {
      color: #0799d7;
      border-bottom: 3px solid #0799d7;
      font-weight: bold;
    }

    .user_icon_mainPage {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
    }

    #mainPage .toolbar {
      background: white !important;
    }

    .fa-star,
    .reviewAverage {
      color: #ffd43b;
    }

    #mainCarousel p {
      margin-top: 3px;
      margin-bottom: 3px;
    }
    #mainCarousel ons-col {
      padding: 5px 7px;
    }

    .mainPageItemText {
      padding: 5px 7px;
      text-align: left;
      font-size: 0.8em;
      width: 100%;
    }

    .salaly {
      float: left;
      padding-left: 5px;
      line-height: 24px;
      font-size: 0.8em;
    }

    .howto {
      float: right;
      padding-right: 5px;
      font-size: 0.8em;
      line-height: 24px;
    }

    .mainHeader {
      position: absolute;
      margin: 0;
      padding: 0;
      border: 0;
      top: 0px;
      left: 0;
      width: 100%;
      z-index: 2;
      background-color: white;
    }

    .mainUserName {
      font-size: 0.9em;
      line-height: 22px;
    }

    #mainPage ons-card {
      text-align: center;
      padding: 7px;
      margin: 0px;
      height: 200px;
      padding-top: 15px;
      padding-bottom: 10px;
    }
    #mainPage .mainReview {
      font-size: 0.8em;
      display: flex;
      justify-content: center;
    }
  </style>
  <ons-toolbar>
    <div
      class="left"
      id="toolbar-title"
      style="display:flex;align-items: center;justify-content: center;"
      onclick="window.location.href = 'index.html';"
    >
      <img
        src="img/knowledgeLogo.png"
        alt=""
        style="height:30px;width:30px;margin:0 auto;"
      />
    </div>
    <div
      class="center"
      id="toolbar-title"
      style="display:flex;align-items: center;justify-content: center;"
      onclick="myNavigator.bringPageTop('html/top/searchBefore.html');"
    >
      <ons-search-input
        style="width:100%;display:flex;align-items: center;justify-content: center;"
        readonly
      ></ons-search-input>
    </div>
    <div
      class="right"
      id="toolbar-title"
      style="display:flex;align-items: center;justify-content: center;"
      onclick="myNavigator.bringPageTop('html/top/notificationPage.html');"
    >
      <i class="far fa-bell fa-lg fa-fw"></i>
    </div>
  </ons-toolbar>

  <div class="mainHeader">
    <ons-carousel
      id="tabCarousel"
      swipeable
      overscrollable
      auto-scroll
      var="carousel"
      item-width="20%"
      centerd
      initial-index="2"
      style="height:28px;border-bottom:1px solid #f0f0f0;"
    >
      <ons-carousel-item id="carousel1">
        <div class="item-label">キャリア</div>
      </ons-carousel-item>
      <ons-carousel-item id="carousel2">
        <div class="item-label">学業</div>
      </ons-carousel-item>
      <ons-carousel-item class="active_tabCarousel" id="carousel3">
        <div class="item-label">全て</div>
      </ons-carousel-item>
      <ons-carousel-item id="carousel4">
        <div class="item-label">ランキング</div>
      </ons-carousel-item>
      <ons-carousel-item id="carousel5">
        <div class="item-label">ビジネス</div>
      </ons-carousel-item>
    </ons-carousel>
  </div>

  <div class="content page__content">
    <ons-pull-hook id="pull-hook" style="margin-top:28px;" height="100px">
      <i class="fas fa-spinner" style="font-size:1.3em;"></i>
    </ons-pull-hook>
    <ons-carousel
      id="mainCarousel"
      swipeable
      overscrollable
      auto-scroll
      var="carousel"
      item-width="100%"
      initial-index="2"
      reflesh="console.log('Changed to ' + $event.activeIndex)"
    >
      <ons-carousel-item style="min-height: 500px;">
        <div
          class="item-label"
          id="careerProduct"
          class="item-label"
          style="display: flex;justify-content: space-between;flex-wrap: wrap;"
        ></div>
      </ons-carousel-item>
      <ons-carousel-item style="min-height: 500px;">
        <div
          class="item-label"
          id="studyProduct"
          class="item-label"
          style="display: flex;justify-content: space-between;flex-wrap: wrap;"
        ></div>
      </ons-carousel-item>
      <ons-carousel-item style="min-height: 500px;">
        <div
          id="allProduct"
          class="item-label"
          style="display: flex;justify-content: space-between;flex-wrap: wrap;"
        ></div>
      </ons-carousel-item>
      <ons-carousel-item style="min-height: 500px;">
        <div class="item-label" style="padding:0.5rem;">
          <ons-row>
            <h4 style="padding-left:0.5rem;font-weight: bold;">
              全てのカテゴリー
            </h4>
          </ons-row>
          <ons-carousel
            auto-refresh
            swipeable
            overscrollable
            item-width="160px"
            id="allCategoryCarousel"
            style="padding-right:50px;"
          >
          </ons-carousel>
          <ons-row>
            <h4
              style="padding-left:0.5rem;font-weight: bold;margin-top:1.0rem;"
            >
              学業
            </h4>
          </ons-row>
          <ons-carousel
            auto-refresh
            swipeable
            overscrollable
            item-width="160px"
            id="studyCategoryCarousel"
            style="padding-right:50px;"
          >
          </ons-carousel>
          <ons-row>
            <h4 style="padding-left:0.5rem;font-weight: bold;margin-top:1rem;">
              ビジネス
            </h4>
          </ons-row>
          <ons-carousel
            auto-refresh
            swipeable
            overscrollable
            item-width="160px"
            id="businessCategoryCarousel"
            style="padding-right:50px;"
          >
          </ons-carousel>
          <ons-row>
            <h4
              style="padding-left:0.5rem;font-weight: bold;margin-top:1.0rem;"
            >
              キャリア
            </h4>
          </ons-row>
          <ons-carousel
            auto-refresh
            swipeable
            overscrollable
            item-width="160px"
            id="careerCategoryCarousel"
            style="padding-right:50px;"
          >
          </ons-carousel>
        </div>
      </ons-carousel-item>
      <ons-carousel-item style="min-height: 500px;">
        <div
          class="item-label"
          id="businessProduct"
          class="item-label"
          style="display: flex;justify-content: space-between;flex-wrap: wrap;"
        ></div>
      </ons-carousel-item>
    </ons-carousel>
  </div>

  <script>
    for (var i = 0; i < 12; i++) {
      if (i == 0 || i == 3 || i == 6 || i == 9) {
        var color = "#ffd43b";
      } else if (i == 1 || i == 4 || i == 7 || i == 10) {
        var color = "#AEB3B5";
      } else {
        var color = "#BA6E40";
      }
      var content =
        `
                <ons-carousel-item id="rankingCard_` +
        i +
        `"style="margin:5px;">
                  <ons-card
                    vertical-align="center"
                    width="50%"
                    style="text-align: center;height:200px;position: relative;"
                  >
                    <img
                      id="rankingImage_` +
        i +
        `"
                      class="user_icon_mainPage"
                      src="img/userSampleImageMan.png"
                      alt=""
                    />
                    <p id="rankingUserName_` +
        i +
        `"class="mainUserName"></p>
                    <p id="rankingReview_` +
        i +
        `"class="mainReview">
                      <img
                        src="img/starOff.png"
                        alt=""
                        style="height:14px;margin-right:3px;"
                      />
                      <img
                        src="img/starOff.png"
                        alt=""
                        style="height:14px;margin-right:3px;"
                      />
                      <img
                        src="img/starOff.png"
                        alt=""
                        style="height:14px;margin-right:3px;"
                      />
                      <img
                        src="img/starOff.png"
                        alt=""
                        style="height:14px;margin-right:3px;"
                      />
                      <img
                        src="img/starOff.png"
                        alt=""
                        style="height:14px;margin-right:3px;"
                      />
                      (0)
                    </p>
                    <div
                      style="display: flex;justify-content: center;align-items: center;height:38px;border-radius: 10px;padding-top:7px;padding-bottom:7px;"
                    >
                      <p id="rankingText_` +
        i +
        `"class="mainPageItemText"></p>
                    </div>

                    <p>
                      <span id="rankingSalalyTime_` +
        i +
        `"class="salaly">

                      </span>
                      <span id="rankingHowTo_` +
        i +
        `"class="howto">

                      </span>
                    </p>
                    <div
                      style="position: absolute;top:10px;left:10px;color:white;font-weight: bold;"
                    >
                      <i class="fas fa-crown fa-lg" style="color:` +
        color +
        `";></i>
                    </div>
                  </ons-card>
                </ons-carousel-item>
                `;
      if (i < 3) {
        $("#allCategoryCarousel").append(content);
      } else if (i > 2 && i < 6) {
        $("#studyCategoryCarousel").append(content);
      } else if (5 < i && i < 9) {
        $("#businessCategoryCarousel").append(content);
      } else if (8 < i) {
        $("#careerCategoryCarousel").append(content);
      }
    }
    var rankingIndicateCount = 0;
    ons.ready(function() {
      var pullHook = document.getElementById("pull-hook");
      pullHook.onAction = function(done) {
        productGet("selfReload", done);
      };
      pullHook.addEventListener("changestate", function(event) {
        var message = "";

        switch (event.state) {
          case "initial":
            message = '<i class="fas fa-spinner" style="font-size:1.3em;"></i>';
            break;
          case "preaction":
            message = '<i class="fas fa-spinner" style="font-size:1.3em;"></i>';
            break;
          case "action":
            message =
              '<i class="fas fa-spinner fa-spin" style="font-size:1.3em;"></i>';
            break;
        }

        pullHook.innerHTML = message;
      });
    });

    ("use strict");
    setTimeout(function() {
      productGet();
      var mainCarousel = document.getElementById("mainCarousel");
      mainCarousel.addEventListener("postchange", function(e) {
        // alert(e.activeIndex);
        tabCarouselChange(e.activeIndex);
      });
    }, 100);

    function tabCarouselChange(carouselIndex) {
      var test = $("#tabCarousel ons-carousel-item").width();
      $("#tabCarousel ons-carousel-item").removeClass("active_tabCarousel");
      $("#tabCarousel ons-carousel-item")
        .eq(carouselIndex)
        .addClass("active_tabCarousel");
      if (carouselIndex == 3) {
        if (rankingIndicateCount == 0) {
          rankingIndicate();
        }
        rankingIndicateCount++;
      }
    }

    ons.ready(function() {
      var page = document.getElementById("mainPage");
      var toolbar = page.querySelector(".toolbar");
      var header = page.querySelector(".mainHeader");
      var content = page.querySelector(".content");
      header.style.top = toolbar.clientHeight + "px";
      content.style.marginTop = 28 + "px";
    });
    function rankingIndicate() {
      showLoad();
      var negotiations = db.collection("negotiations");
      negotiations.get().then(function(negotiation) {
        rankingForEachPromise(negotiation)
          .then(function(rankingArray) {
            return rankingArray;
          })
          .then(function(rankingArray) {
            rankingArray.sort(function(a, b) {
              if (a.count > b.count) {
                return -1;
              } else {
                return 1;
              }
            });
            return rankingArray;
          })
          .then(function(rankingArray) {
            var businessRankingArray = rankingArray.filter(
              item => item.category1 == "ビジネス"
            );

            var studyRankingArray = rankingArray.filter(
              item => item.category1 == "学業"
            );

            var careerRankingArray = rankingArray.filter(
              item => item.category1 == "キャリア"
            );

            rankingBorn(rankingArray, "All");
            rankingBorn(businessRankingArray, "business");
            rankingBorn(careerRankingArray, "career");
            rankingBorn(studyRankingArray, "study");
          })
          .catch(function(error) {
            console.log(error);
          });
      });
    }

    function rankingBorn(rankingArray, category) {
      if (category == "All") {
        var rankingArrayCount = 0;
        if (rankingArray.length < 3) {
          var deleteCount = 0 + rankingArray.length;
          for (deleteCount; deleteCount < 3; deleteCount++) {
            $("#rankingCard_" + deleteCount).remove();
          }
        }
      } else if (category == "business") {
        var rankingArrayCount = 6;
        if (rankingArray.length < 3) {
          var deleteCount = 6 + rankingArray.length;
          for (deleteCount; deleteCount < 9; deleteCount++) {
            $("#rankingCard_" + deleteCount).remove();
          }
        }
      } else if (category == "career") {
        var rankingArrayCount = 9;
        if (rankingArray.length < 3) {
          var deleteCount = 9 + rankingArray.length;
          for (deleteCount; deleteCount < 12; deleteCount++) {
            $("#rankingCard_" + deleteCount).remove();
          }
        }
      } else if (category == "study") {
        var rankingArrayCount = 3;
        if (rankingArray.length < 3) {
          var deleteCount = 3 + rankingArray.length;
          for (deleteCount; deleteCount < 6; deleteCount++) {
            $("#rankingCard_" + deleteCount).remove();
          }
        }
      }

      rankingArray.forEach(function(rank) {
        if (rankingArrayCount < rankingArrayCount + 3) {
          db.collection("products")
            .doc(rank.productId)
            .get()
            .then(function(productInfo) {
              var userId = productInfo.data().userId;
              var howto = productInfo.data().howtotalk;
              var price = productInfo.data().price;
              var time = productInfo.data().time;
              var title = productInfo.data().title;
              var productArray = [
                userId,
                howto,
                price,
                time,
                title,
                rankingArrayCount,
                rank.productId
              ];
              rankingArrayCount++;
              return productArray;
            })
            .then(function(productArray) {
              var userId = productArray[0];
              var howto = productArray[1];
              var price = productArray[2];
              var time = productArray[3];
              var title = productArray[4];
              var rankingArrayCount = productArray[5];
              var productId = productArray[6];

              db.collection("users")
                .doc(userId)
                .get()
                .then(function(userInfo) {
                  var username = userInfo.data().username;
                  ref = firebase
                    .storage()
                    .ref()
                    .child("profilePicture/" + userId);
                  ref
                    .getDownloadURL()
                    .then(url => {
                      // 画像取得できた
                      return url;
                    })
                    .catch(function() {
                      // 画像取得できないとき
                      url = "img/userSampleImageMan.png";
                      return url;
                    })
                    .then(function(url) {
                      document.getElementById(
                        "rankingCard_" + rankingArrayCount
                      ).onclick = new Function(
                        "giftDetailJump('" + productId + "')"
                      );
                      $("#rankingImage_" + rankingArrayCount).attr("src", url);
                      $("#rankingUserName_" + rankingArrayCount).html(username);
                      $("#rankingText_" + rankingArrayCount).html(title);
                      $("#rankingSalalyTime_" + rankingArrayCount).html(
                        "¥" + price + "/" + time
                      );
                      $("#rankingHowTo_" + rankingArrayCount).html(howto);
                      reviewControl(userId).then(function(result) {
                        $("#rankingReview_" + rankingArrayCount).empty();
                        for (var i = 1; i < 6; i++) {
                          if (i > result[1]) {
                            var star =
                              '<img src="img/starOff.png" alt="" style="height:14px;margin-right:3px;"/>';
                          } else {
                            var star =
                              '<img src="img/starOn.png" alt=""style="height:14px;margin-right:3px;"/>';
                          }
                          $("#rankingReview_" + rankingArrayCount).append(star);
                        }
                        $("#rankingReview_" + rankingArrayCount).append(
                          "(" + result[0] + ")"
                        );
                      });
                    });

                  hideLoad();
                });
            });
        }
      });
    }
    function productGet(selfReload, done) {
      if (selfReload != "selfReload") {
        showLoad();
      }
      $("#allProduct").empty();
      $("#careerProduct").empty();
      $("#studyProduct").empty();
      $("#businessProduct").empty();
      var nowDataCount = 0;
      var products = db.collection("products");
      products
        .where("releasestatus", "==", "syuppin")
        .orderBy("createTime", "desc")
        .get()
        .then(results => {
          // console.log(results.size);
          if (results.size > 0) {
            results.forEach(doc => {
              nowDataCount++;
              var product =
                `
              <div style="text-align: center;width:47.5%;padding:0.25em;">
                <ons-card class="mainCard mainCard_` +
                nowDataCount +
                `">
                  <img class="user_icon_mainPage mainImage_` +
                nowDataCount +
                `"alt="" />
                  <p class="mainUserName mainUserName_` +
                nowDataCount +
                `"></p>
                  <p class="mainReview_` +
                nowDataCount +
                `"class="mainReview">
                  <img src="img/starOff.png" alt="" style="height:14px;margin-right:3px;"/>
                  <img src="img/starOff.png" alt="" style="height:14px;margin-right:3px;"/>
                  <img src="img/starOff.png" alt="" style="height:14px;margin-right:3px;"/>
                  <img src="img/starOff.png" alt="" style="height:14px;margin-right:3px;"/>
                  <img src="img/starOff.png" alt="" style="height:14px;margin-right:3px;"/>
                  (0)
                  </p>
                  <div style="display: flex;justify-content: center;align-items: center;height:38px;border-radius: 10px;padding-top:7px;padding-bottom:7px;">
                  <p class="mainPageItemText mainTitle_` +
                nowDataCount +
                `"></p></div>
                  <p>
                    <span class="salaly mainSalalyTime_` +
                nowDataCount +
                `"></span>
                    <span class="howto mainHowTo_` +
                nowDataCount +
                `"></span>
                  </p>
                </ons-card>
              </div>
            `;
              $("#allProduct").append(product);
              if (doc.data().category1 == "キャリア") {
                $("#careerProduct").append(product);
              } else if (doc.data().category1 == "学業") {
                $("#studyProduct").append(product);
              } else if (doc.data().category1 == "ビジネス") {
                $("#businessProduct").append(product);
              }

              productIndicate(
                doc.id,
                doc.data(),
                nowDataCount,
                results.size,
                selfReload,
                done
              );
            });
          } else {
            hideLoad();
          }
        })
        .catch(error => {
          console.log(`データの取得に失敗しました (${error})`);
          hideLoad();
        });
    }

    function productIndicate(
      docId,
      data,
      nowDataCount,
      size,
      selfReload,
      done
    ) {
      var userId = data.userId;
      var docRef = db.collection("users").doc(userId);
      docRef
        .get()
        .then(function(doc) {
          if (doc.exists) {
            var url = "";
            var user = firebase.auth().currentUser;
            var username = doc.data().username;
            firebase
              .storage()
              .ref()
              .child("profilePicture/" + data.userId)
              .getDownloadURL()
              .then(url => {
                // 画像取得できた
                return url;
              })
              .catch(function() {
                // 画像取得できないとき
                url = "img/userSampleImageMan.png";
                return url;
              })
              .then(function(url) {
                var btn4 = document.getElementsByClassName(
                  "mainCard_" + nowDataCount
                );
                for (var i = 0; i < btn4.length; i++) {
                  btn4[i].onclick = function() {
                    giftDetailJump(docId);
                  };
                }
                $(".mainUserName_" + nowDataCount).html(doc.data().username);
                $(".mainImage_" + nowDataCount).attr("src", url);
                $(".mainTitle_" + nowDataCount).html(data.title);
                $(".mainSalalyTime_" + nowDataCount).html(
                  "¥" + data.price + "/" + data.time
                );
                $(".mainHowTo_" + nowDataCount).html(data.howtotalk);
                reviewControl(data.userId).then(function(result) {
                  $(".mainReview_" + nowDataCount).empty();
                  for (var i = 1; i < 6; i++) {
                    if (i > result[1]) {
                      var star =
                        '<img src="img/starOff.png" alt="" style="height:14px;margin-right:3px;"/>';
                    } else {
                      var star =
                        '<img src="img/starOn.png" alt=""style="height:14px;margin-right:3px;"/>';
                    }
                    $(".mainReview_" + nowDataCount).append(star);
                  }
                  $(".mainReview_" + nowDataCount).append(
                    "(" + result[0] + ")"
                  );
                });
                if (nowDataCount == size) {
                  if (selfReload != "selfReload") {
                    hideLoad();
                  } else {
                    done();
                  }
                }
              });
          } else {
            // doc.data() will be undefined in this case
            console.log("No such document!");
          }
        })
        .catch(function(error) {
          console.log("Error getting document:", error);
        });
    }

    function giftDetailJump(docId) {
      myNavigator.bringPageTop("html/product/productDetail.html");
      setTimeout(function() {
        productInfo(docId);
      }, 100);
    }
    function reviewControl(userId) {
      return new Promise(resolve => {
        db.collection("users")
          .doc(userId)
          .collection("reviews")
          .get()
          .then(function(reviews) {
            var reviewArray = [];
            reviews.forEach(review => {
              reviewArray.push(review.data().reviewCount);
            });
            var sum = 0;
            var reviewQuantity = reviewArray.push();
            reviewArray.forEach(function(v) {
              sum += Number(v);
            });
            if (reviewQuantity > 0) {
              var reviewAverage = sum / reviewQuantity;
            } else {
              var reviewAverage = 0;
            }
            var reviewInfo = [reviewQuantity, Math.round(reviewAverage)];
            resolve(reviewInfo);
          });
      });
    }

    function rankingForEachPromise(negotiation) {
      var counter = 0;
      var rankingArray = [];
      return new Promise(resolve => {
        negotiation.forEach(function(nego) {
          var productId = nego.data().productId;

          var products = db
            .collection("products")
            .doc(productId)
            .get()
            .then(function(product) {
              var category1 = product.data().category1;
              return category1;
            })
            .then(function(category1) {
              if (
                rankingArray.some(ranking => ranking.productId == productId)
              ) {
                var result = rankingArray.filter(
                  ranking => ranking.productId === productId
                );
                result[0].count++;
              } else {
                rankingArray.push({
                  productId: productId,
                  count: 1,
                  category1: category1
                });
              }
              counter++;
              if (counter == negotiation.size) {
                resolve(rankingArray);
              }
            });
        });
      });
    }

    function torihikiPageJump(productId, buyUserId, productUserId) {
      myNavigator.bringPageTop("html/product/productTorihiki.html");
      setTimeout(function() {
        $("#torihikiPageProductId").val(productId);
        $("#torihikiPageProductUserId").val(productUserId);
        $("#torihikiPagebuyUserId").val(buyUserId);
        torihikiIndicate(productId, buyUserId, productUserId);
      }, 100);
    }

    document.addEventListener("deviceready", function() {
      window.NCMB.monaca.setDeviceToken(
        appKey,
        clientKey,
        result => {
          console.log(result);
        },
        err => console.log("通知設定エラー：" + JSON.stringify(err))
      );

      setTimeout(function() {
        getInstallationId();
      }, 5000);
      setTimeout(function() {
        getInstallationId();
      }, 10000);
    });

    function getInstallationId() {
      NCMB.monaca.getInstallationId(id => {
        ncmb.Installation.equalTo("objectId", id)
          .fetch()
          .then(installation => {
            var user = firebase.auth().currentUser;
            installation.set("userId", user.uid).update();
          })
          .catch(err => console.log("通知設定エラー：" + JSON.stringify(err)));
      });
    }

    function sendPush() {
      var user = firebase.auth().currentUser;
      var push = new ncmb.Push();
      push
        .set("immediateDeliveryFlag", true)
        .set("message", "Hello, World!")
        .set("target", ["ios", "android"])
        .set("searchCondition", {
          userId: user.uid
        });

      push
        .send()
        .then(function(push) {
          // 送信後処理
          ncmb.Push.order("createDate", true)
            .fetch()
            .then(function(push) {
              var where = push.searchCondition;
              var targets = push.target;
              ncmb.Installation.where(where)
                .limit(1000)
                .in("deviceType", targets)
                .fetchAll()
                .then(function(installations) {
                  for (let installation of installations) {
                    if (!installation.pushes) {
                      installation.set("pushes", [push.objectId]);
                    } else {
                      installation.add(push.objectId);
                    }
                    installation.update();
                  }
                });
            });
        })
        .catch(function(err) {
          // エラー処理
        });
    }

    function firebaseTimeControl(time) {
      var createTime = new Date(time * 1000);
      var MM = createTime.getMonth() + 1;
      //「日」を取得する
      var DD = createTime.getDate();
      //「時」を取得する
      var hh = createTime.getHours();
      //「分」を取得する
      var mm = createTime.getMinutes();
      if (hh < 10) {
        hh = "0" + hh;
      }
      if (mm < 10) {
        mm = "0" + mm;
      }
      var time = MM + "月" + DD + "日 " + hh + ":" + mm;
      return time;
    }
  </script>
</ons-page>
