<ons-page id="productDetailPage">
  <style>
    .productTitle .fa-heart,
    .productTitle .fa-comment-dots {
      margin-right: 0.5rem;
    }
    .productTitle .fa-comment-dots {
      margin-left: 1rem;
    }
    #productDetailPage ons-list p {
      margin-top: 0px;
      margin-bottom: 0px;
    }

    #productDetailComment ons-card {
      margin-left: 0px;
      margin-top: 0px;
    }
    #productDetailPage .list-item__center {
      background-image: none;
      padding-top: 5px;
      padding-bottom: 5px;
    }
    #productDetailComment {
      background-image: none;
      background-color: #eee;
    }

    #productDetailComment .list-item__title {
      font-size: 0.8em;
    }
  </style>
  <ons-toolbar>
    <div class="left" id="toolbar-title">
      <ons-back-button></ons-back-button>
    </div>
    <div class="center" id="toolbar-title"></div>
  </ons-toolbar>
  <ons-bottom-toolbar style="line-height: 35px;height:80px">
    <ons-row>
      <ons-col
        width="100%"
        style="text-align: center;font-size:0.9em;color:white;font-weight: bold;background: #0799d7;line-height: 25px;margin-bottom:5px;"
        vertical-align="center"
        >500ポイント持っています</ons-col
      >
    </ons-row>
    <ons-row>
      <ons-col
        id="productDetailPriceTime"
        width="50%"
        style="text-align: center;font-size:1.2em;"
        vertical-align="center"
        >¥/分</ons-col
      >
      <ons-col width="50%" style="text-align: center;" vertical-align="center">
        <ons-button
          id="productDetailButton"
          class="large-button-orange"
          style="padding:5px 2em;font-size:1.2em;"
          onclick="showProductDetailModal()"
          >購入</ons-button
        >
      </ons-col>
    </ons-row>
  </ons-bottom-toolbar>
  <div style="width:85%;margin:0 auto;margin-top:0px;">
    <div style="height:70px;text-align: center;margin-top:1.5rem;">
      <img
        id="productDetailUserImage"
        src="img/userSampleImageMan.png"
        alt=""
        style="width:70px;height:70px;object-fit:cover;border-radius: 50%;"
      />
    </div>
    <p
      id="productDetailUserName"
      style="text-align: center;margin-top:5px;margin-bottom:5px;"
    ></p>

    <div>
      <p
        style="text-align: center;width:100%;margin-top:5px;margin-bottom:5px;"
      >
        <img src="img/starOn.png" alt="" style="height:18px;" />
        <img src="img/starOn.png" alt="" style="height:18px;" />
        <img src="img/starOn.png" alt="" style="height:18px;" />
        <img src="img/starOn.png" alt="" style="height:18px;" />
        <img src="img/starOff.png" alt="" style="height:18px;" />
        <span>(39)</span>
      </p>
    </div>
    <p id="productDetailText" class="navy" style="font-size:0.8em;"></p>
  </div>
  <div style="width:100%;margin:0 auto;margin-top:20px;margin-bottom:50px;">
    <ons-list-header>商品タイトル</ons-list-header>
    <ons-list-item class="productTitle">
      <ons-row id="productDetailTitle" style="font-weight: bold;"> </ons-row>
      <ons-row>
        <p style="margin-bottom:0px;">
          <i class="far fa-heart"></i>3<i
            class="far fa-comment-dots"
            onclick="myNavigator.bringPageTop('html/productComment.html');"
          ></i
          >4
        </p>
      </ons-row>
    </ons-list-item>
    <ons-list-header>商品の説明</ons-list-header>
    <ons-list-item>
      <ons-row
        id="productDetailExplanation"
        style="font-size:0.8em;padding-right:0.25em;"
      >
      </ons-row>
    </ons-list-item>
    <ons-list-header>通話手段</ons-list-header>
    <ons-list-item>
      <ons-row id="productDetailHowToTalk"> </ons-row>
    </ons-list-item>
    <br />
    <ons-list id="productDetailComment">
      <ons-list-item>
        <br />
        <ons-row>
          <i class="far fa-comment-dots" style="margin-right:0.3em;"></i
          >コメント
        </ons-row>
      </ons-list-item>
      <ons-list-item>
        <div class="left">
          <img
            class="list-item__thumbnail"
            src="img/image61.jpg"
            style="width:45px;height:45px;border-radius: 50%;object-fit:cover;"
          />
        </div>
        <div class="center" style="width:50%;">
          <span class="list-item__title">ハナコ</span>
          <span class="list-item__subtitle">
            <ons-card>
              質問してもよろしいですか？質問してもよろしいですか？質問してもよろしいですか？質問してもよろしいですか？
            </ons-card>
          </span>
        </div>
      </ons-list-item>
      <ons-list-item>
        <div class="left">
          <img
            class="list-item__thumbnail"
            src="img/manSample.jpeg"
            style="width:45px;height:45px;border-radius: 50%;object-fit:cover;"
          />
        </div>
        <div class="center" style="width:50%;">
          <span class="list-item__title">タナカタロウ</span>
          <span class="list-item__subtitle">
            <ons-card>
              質問してもいいですよ
            </ons-card>
          </span>
        </div>
      </ons-list-item>
      <ons-list-item>
        <div class="left">
          <img
            class="list-item__thumbnail"
            src="img/image61.jpg"
            style="width:45px;height:45px;border-radius: 50%;object-fit:cover;"
          />
        </div>
        <div class="center" style="width:50%;">
          <span class="list-item__title">ハナコ</span>
          <span class="list-item__subtitle">
            <ons-card>
              質問してもよろしいですか？質問してもよろしいですか？質問してもよろしいですか？質問してもよろしいですか？
            </ons-card>
          </span>
        </div>
      </ons-list-item>
      <ons-list-item>
        <div class="left">
          <img
            class="list-item__thumbnail"
            src="img/manSample.jpeg"
            style="width:45px;height:45px;border-radius: 50%;object-fit:cover;"
          />
        </div>
        <div class="center" style="width:50%;">
          <span class="list-item__title">タナカタロウ</span>
          <span class="list-item__subtitle">
            <ons-card>
              質問してもいいですよ
            </ons-card>
          </span>
        </div>
      </ons-list-item>
      <ons-list-item>
        <ons-row style="padding:1em;">
          <ons-button
            class="large-button-gray"
            style="margin:0 auto;"
            onclick="myNavigator.bringPageTop('html/productComment.html');"
            >全てのコメントを見る</ons-button
          >
        </ons-row>
      </ons-list-item>
    </ons-list>
  </div>
  <ons-modal id="productDetailModal" direction="up">
    <div style="text-align: center">
      <ons-card>
        <ons-list style="background-image: none;">
          <ons-list-item>
            <ons-row>
              <ons-col>
                <p style="text-align: center;font-size:1.2em;">
                  購入手続き
                  <span
                    style="float:right;padding-right:0.5em;"
                    onclick="hideProductDetailModal()"
                    ><i class="fas fa-times"></i
                  ></span>
                </p>
              </ons-col>
            </ons-row>
          </ons-list-item>
          <ons-list-item>
            <ons-row>
              <ons-col width="50%" vertical-align="center">
                サービス代金
              </ons-col>
              <ons-col
                id="productDetailModalPrice"
                width="50%"
                vertical-align="center"
                style="text-align: right;padding-right:0.5em;"
                >¥3000</ons-col
              >
            </ons-row>
          </ons-list-item>
          <ons-list-item>
            <ons-row>
              <ons-col width="50%" vertical-align="center">
                ポイント使用
              </ons-col>
              <ons-col
                id="productDetailModalMyPoint"
                width="50%"
                vertical-align="center"
                style="text-align: right;padding-right:0.5em;"
                >500P</ons-col
              >
            </ons-row>
          </ons-list-item>
          <ons-list-item>
            <ons-row>
              <ons-col width="50%" vertical-align="center">
                売上金を利用
              </ons-col>
              <ons-col
                width="50%"
                vertical-align="center"
                style="text-align: right;padding-right:0.5em;"
              >
                売上があります >
              </ons-col>
            </ons-row>
          </ons-list-item>
          <ons-list-item>
            <ons-row>
              <ons-col width="50%" vertical-align="center">
                支払い方法
              </ons-col>
              <ons-col
                width="50%"
                vertical-align="center"
                style="text-align: right;padding-right:0.5em;"
                >カード払い ></ons-col
              >
            </ons-row>
          </ons-list-item>
          <ons-list-item>
            <ons-row>
              <ons-col width="50%" vertical-align="center">
                支払い金額
              </ons-col>
              <ons-col
                width="50%"
                vertical-align="center"
                style="font-size:1.2em;font-weight: bold;text-align: right;padding-right:0.5em;"
                >¥2500</ons-col
              >
            </ons-row>
          </ons-list-item>
          <ons-list-item>
            <ons-row>
              <ons-col width="50%" vertical-align="center">
                通話手段
              </ons-col>
              <ons-col
                id="productDetailModalHowToTalk"
                width="50%"
                vertical-align="center"
                style="text-align: right;padding-right:0.5em;"
                >Zoom</ons-col
              >
            </ons-row>
          </ons-list-item>
          <ons-list-item>
            <ons-row>
              <ons-col
                width="100%"
                vertical-align="center"
                style="text-align: center;"
              >
                <ons-button
                  class="large-button-orange"
                  style="padding-left:2em;padding-right:2em;"
                  onclick="myNavigator.bringPageTop('html/productTorihiki.html');"
                  >購入する</ons-button
                >
              </ons-col>
            </ons-row>
          </ons-list-item>
        </ons-list>
      </ons-card>
    </div>
  </ons-modal>
  <script>
    function showProductDetailModal() {
      var modal = document.querySelector("#productDetailModal");
      modal.show();
    }

    function hideProductDetailModal() {
      var modal = document.querySelector("#productDetailModal");
      modal.hide();
    }

    function productInfo(docId) {
      showLoad();
      var docRef = db.collection("products").doc(docId);

      docRef
        .get()
        .then(function(doc) {
          // 商品情報取得
          $("#productDetailTitle").html(doc.data().title);
          $("#productDetailExplanation").html(doc.data().explanation);
          $("#productDetailHowToTalk").html(doc.data().howtotalk);
          $("#productDetailPriceTime").html(
            "¥" + doc.data().price + "/" + doc.data().time
          );
          $("#productDetailModalHowToTalk").html(doc.data().howtotalk);
          if (doc.data().howtotalk == "その他") {
            $("#productDetailModalHowToTalk").append(doc.data().howtotalkother);
          }
          $("#productDetailModalPrice").html(doc.data().price);
          var productData = doc.data();
          return productData;
        })
        .then(function(productData) {
          // ユーザー情報取得
          var docRef = db.collection("users").doc(productData.userId);

          docRef.get().then(function(doc) {
            $("#productDetailUserName").html(doc.data().username);
            $("#productDetailText").html(doc.data().text);
            // ユーザー写真取得
            ref = firebase
              .storage()
              .ref()
              .child("profilePicture/" + productData.userId);
            ref.getDownloadURL().then(url => {
              if (url != "") {
                document.getElementById("productDetailUserImage").src = url;
              }
            });
          });
          return productData;
        })
        .then(function(productData) {
          var user = firebase.auth().currentUser;
          var myUserId = user.uid;
          if (myUserId == productData.userId) {
            $("#productDetailButton").html("変更");
            document.getElementById(
              "productDetailButton"
            ).onclick = new Function(
              "myProductEdit('" +
                JSON.stringify(productData) +
                "','" +
                docId +
                "');"
            );
          }
          hideLoad();
        })
        .catch(function(error) {
          hideLoad();
          console.log("Error getting document:", error);
        });
    }

    function myProductEdit(productData, productDocumentUid) {
      var productData = JSON.parse(productData);
      myNavigator.bringPageTop("html/product/syuppinEditPage.html");

      document.addEventListener(
        "init",
        function(event) {
          if (event.target.matches("#syuppinEditPage")) {
            $("#productDocumentUid").val(productDocumentUid);
            //初期値で入れておく
            $("#syuppinCategory1Edit").val(productData.category1);
            $("#syuppinCategory2Edit").val(productData.category2);
            $("#syuppinCategory3Edit").val(productData.category3);
            $("#syuppinTitleEdit").val(productData.title);
            $("#syuppinExplanationEdit").val(productData.explanation);
            $("#howToTalkEdit").val(productData.howtotalk);
            $("#howToTalkOtherEdit").val(productData.howtotalkother);
            $("#syuppinTimeEdit").val(productData.time);
            $("#syuppinPriceEdit").val(productData.price);
            if (productData.category3 == "") {
              $("#syuppinCategoryEdit").html(
                productData.category1 +
                  " ><br>" +
                  productData.category2 +
                  "&emsp;"
              );
            } else {
              $("#syuppinCategoryEdit").html(
                productData.category1 +
                  " ><br>" +
                  productData.category2 +
                  " ><br>" +
                  productData.category3 +
                  "&emsp;"
              );
            }
            riekiCalc();
          }
        },
        false
      );
    }
  </script>
</ons-page>
