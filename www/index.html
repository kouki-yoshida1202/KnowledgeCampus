<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
    />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src * knowledgecampus data: gap: https://ssl.gstatic.com;img-src * 'self' blob: data:; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'"
    />
    <script src="components/loader.js"></script>
    <script src="lib/onsenui/js/onsenui.min.js"></script>
    <script src="lib/onsenui/js/bower.js"></script>

    <link rel="stylesheet" href="components/loader.css" />
    <link rel="stylesheet" href="lib/onsenui/css/onsenui.css" />
    <link rel="stylesheet" href="lib/onsenui/css/onsen-css-components.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Lato:400,700|Noto+Sans+JP:400,700"
      rel="stylesheet"
    />
    <script src="lib/onsenui/js/loadingoverlay.min.js"></script>
    <script src="../node_modules/compressorjs/dist/compressor.js"></script>

    <script></script>
    <style></style>
  </head>
  <body>
    <ons-navigator id="myNavigator"></ons-navigator>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
    https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-storage.js"></script>
    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyA56OkCzhlaMNwunHOsxXbS5z7mJBzMSFM",
        authDomain: "knowledgecampus-test.firebaseapp.com",
        databaseURL: "https://knowledgecampus-test.firebaseio.com",
        projectId: "knowledgecampus-test",
        storageBucket: "knowledgecampus-test.appspot.com",
        messagingSenderId: "1036117855994",
        appId: "1:1036117855994:web:7a317f24ce2905014b4343",
        measurementId: "G-YQLTPSJSVH"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();
      var db = firebase.firestore();
      var storage = firebase.storage();
      ons.ready(function() {
        var myNavigator = document.getElementById("myNavigator");
        // var obj = localStorage.getItem("first-time");
        // console.log(obj);
        // obj = false;
        // if (obj == false) {
        // ログインチェック
        firebase.auth().onAuthStateChanged(user => {
          if (user) {
            if (!user.emailVerified) {
              // メアド確認終わってない
              myNavigator.pushPage("html/loginPage.html");
            } else {
              // メアド確認終わってる
              myNavigator.pushPage("html/homePage.html");
            }
          } else {
            myNavigator.pushPage("html/loginPage.html");
          }
        });
        // } else {
        //   myNavigator.pushPage("html/firstPage.html");
        // }
      });

      if (ons.platform.isIPhoneX()) {
        document.documentElement.setAttribute("onsflag-iphonex-portrait", "");
        document.documentElement.setAttribute("onsflag-iphonex-landscape", "");
      }
      function showLoad() {
        $("body").LoadingOverlay("show", {
          image: "",
          fontawesome: "fa fa-spinner fa-spin fa-small"
        });
        setTimeout(function() {
          $("body").LoadingOverlay("hide");
        }, 7000);
      }

      function hideLoad() {
        $("body").LoadingOverlay("hide");
      }

      function handleOpenURL(url) {
        setTimeout(function() {
          var strValue = decodeURIComponent(url);
          var urlPrm = [];
          strValue = strValue.replace("knowledgecampus://", "");
          var urlSearch = strValue.substring(1).split("&");
          for (i = 0; urlSearch[i]; i++) {
            var kv = urlSearch[i].split("=");
            urlPrm[kv[0]] = kv[1];
          }
          var productId = urlPrm.productId;
          giftDetailJump(productId);
        }, 100);
      }

      // dataURIをBlobに変換する関数
      function toBlob(dataURI) {
        const byteString = atob(dataURI.split(",")[1]);
        const mimeType = dataURI.match(/(:)([a-z\/]+)(;)/)[2];
        for (
          var i = 0, l = byteString.length, content = new Uint8Array(l);
          l > i;
          i++
        ) {
          content[i] = byteString.charCodeAt(i);
        }
        return new Blob([content], {
          type: mimeType
        });
      }
    </script>
  </body>
</html>
